{% extends 'base.html' %}
{% load offers_extras %}

{% block content %}
	
	<div class="page_content clearfix">

					<div class="left">

						<div class="box box_sep">
							<div class="main_icon locker">
								<h1>Ofertas en Cittybox</h1>
								<p>Aqui encontraras las mejores ofertas en tus tiendas preferidas:</p>
							</div>
							
							<div class="oferta_del_dia expanded">
								<h5><span class="offer_arrow"></span>Oferta del d√≠a</h5>

								<div class="oferta_del_dia_cont">

									<div class="oferta_left">

										<div class="slider_ofertas">
											<img src="{{MEDIA_URL}}{{ main_offer.imagen }}" width="287" />
											
										</div>

										<div id="slider_pager"></div>

									</div>

									<div class="oferta_right">
										<h2><a target="_blank" href="{{ main_offer.url }}">{{ main_offer.titulo|truncatewords:5 }}</a></h2>
										<span class="price">${{ main_offer.precio }}</span> 
										{% if main_offer.precio_anterior %}
											<span class="old_price">{{ main_offer.precio_anterior }}</span>
										{% endif %}
										<p>{{ main_offer.descripcion|truncatewords:40 }}</p>
										<p><a target="_blank" href="{{ main_offer.url }}" class="btn set2">Comprar</a></p>
									</div>

								</div><!-- END oferta_del_dia_cont-->


							</div>



						</div>


						<div class="box">

							<div class="table_header clearfix">
								<div class="th_l">
									<form>
										<label class="inlined">Filtrar por: </label>
										<select class="tiny_select" id="categorias_select" onchange="filtrar_categoria(this);">
										<option value="n">Seleccione una categoria</option>
										{% for categoria in categorias %}
											<option value="{{categoria.id}}">{{ categoria.nombre }}</option>
										{% endfor %}	
										<option value="todas">Todas las ofertas</option>
										</select>
									</form>
								</div>
								<div class="th_r">
									
										<input id="search" type="text" class="text" value="" />
									
								</div>
							</div>

							<div id="offers_list">
								{% offers_list %}
							</div
							

						</div>



					</div><!-- END left -->

					<script type="text/javascript">
						
						function filtrar_categoria(elem){
							id = $(elem).val();
							if( id == "todas" ){
								document.location = "{% url offers %}"
							}
							if( id != "n" ){
								$('#offers_list').load('/filtrar_categoria/'+id+"?page=1", function() {
								  $(this).prepend("<h3>Ofertas en categoria '"+$(elem).find("option:selected").text()+"'</h3>");
								});
							}
						}

						function paginate(elem, by_cat){
							page = $(elem).attr("rel");
							if( by_cat ){
								id = $("#categorias_select").val();
								$('#offers_list').load('/filtrar_categoria/'+id+page, function() {
									console.log($("#categorias_select"));
								  $('#offers_list').prepend("<h3>Ofertas en categoria '"+$("#categorias_select").find("option:selected").text()+"'</h3>");
								});
							}else{
								$('#offers_list').load('/offers_list'+page, function() {
									  
								});
							}
							return true;
						}

						function search(elem){
							input = $(elem);
							alert(input.val());
							$('#offers_list').load('/search?q='+input.val(), function(data) {
								$('#offers_list').html(data);
							});
							return true;
						}

					</script>
{% endblock %}

{% block javascript_extra %}
$("#search").keypress(function(e){
code= (e.keyCode ? e.keyCode : e.which);
if (code == 13) search(this);

}); 
{% endblock %}